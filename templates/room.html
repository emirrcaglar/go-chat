{{define "room"}}
{{template "layout" .}}
{{end}}

{{define "content"}}
<div id="chat-window" style="border: 1px solid; height:300px; overflow-y: scroll; padding: 10px;">
</div>
<input type="text" id="message-input" placeholder="type a message">
<button onclick="sendMessage()">Send</button>

<script>
    const roomId = "{{.RoomIndex}}";
    const username = "{{.Username}}";
    console.log('roomId: ', roomId);
    console.log('username: ', username);
    
    const socket = new WebSocket("ws://localhost:3000/ws/room/" + roomId);
    console.log('socket: ', socket.url);
    
    const chatWindow = document.getElementById('chat-window');
    const messageInput = document.getElementById('message-input');
    
    socket.onmessage = function(event) {
        const message = JSON.parse(event.data);
        const display_text = `${message.username}: ${message.content}`;
        const messageElement = document.createElement('p');
        messageElement.textContent = display_text;
        chatWindow.appendChild(messageElement);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }
    
    function sendMessage() {
        const content = messageInput.value;
        if (content.trim() == '') return;
        
        const message = {
            username: username,
            content: content,
            roomID: roomId
        }
        
        socket.send(JSON.stringify(message))
        messageInput.value = ''
    }
    
    messageInput.addEventListener('keypress', function(event){
        if (event.key == 'Enter'){
            sendMessage();
        }
    });
</script>
{{end}}